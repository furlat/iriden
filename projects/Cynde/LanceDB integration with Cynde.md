[[LanceDB]] [[Cynde]]
 This is a part of a broader framework to use LLMs to generate new columns in a polars dataframe with row-wise parallelized llm operations. The integration of polars/lancedb would allow to augment this pipeline to do parallel retrieval augmented generation (or the prompt construction for) for each row. My simpler use case is basically sorting string columns by similarity with respect to a query string (by their embedding similarity of course) . More advanced is for each row deriving the k-nearest neigbours in the frame so basically creating a new column with a list of neighbor indexes for each row based on a vector search of the relative columns.  
Of course it would be beutiful to have this operations as part of an expression. I have some hacky solutions moving via python in between polars/numpy or using some polars exstension but nothing very scalable especially for the n^2 search. On the other side I can not give up polars expressions syntax for filtering, working on the frame because it is too good and integrates in all the rest of my stack. (edited)


Also storing the embeddings in polars is pretty bad, especially with rows with a lot of duplicates. I will try to use the current integration and simply load the embeddings of the unque elements of each column(with some metadata to join back into the full polars frame) into lance, do the search there and move back to polars and do some timings. Seems like things will only improve if I start from that! Not sure in what direction if would pushdown this operations if lance --> polars for the filters or polars to lance for the vector search but that is above my understanding